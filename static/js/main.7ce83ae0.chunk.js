(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{18:function(e,a,t){e.exports=t(35)},27:function(e,a,t){},35:function(e,a,t){"use strict";t.r(a);var r=t(0),o=t.n(r),c=t(14),n=(t(27),t(1)),l=t(7),d=t.n(l);var s=e=>{let{onScan:a}=e;const[t,c]=Object(r.useState)(!1),[n,l]=Object(r.useState)(""),[s,i]=Object(r.useState)("environment"),m=Object(r.useRef)(null),u=new Audio("scanner-beep.mp3"),b=()=>{c(!0),l("Iniciando esc\xe1ner..."),setTimeout(()=>{d.a.init({inputStream:{type:"LiveStream",target:m.current||document.querySelector("#video"),constraints:{width:640,height:480,facingMode:s}},decoder:{readers:["ean_reader","code_128_reader","upc_reader"]}},e=>{if(e)return console.error(e),void l("Error al iniciar el esc\xe1ner");d.a.start(),l("Escaneando...")}),d.a.onDetected(p)},500)},g=()=>{d.a.offDetected(p),d.a.stop(),c(!1),l("")},p=e=>{const t=e.codeResult.code;l("C\xf3digo detectado: ".concat(t)),a(t),u.play().catch(e=>console.log("\ud83d\udd07 No se pudo reproducir el sonido:",e)),g()};return Object(r.useEffect)(()=>()=>{t&&g()},[t]),o.a.createElement("div",{className:"relative"},o.a.createElement("button",{onClick:t?g:b,className:"py-2 px-4 rounded-lg transition-colors ".concat(t?"bg-red-500 hover:bg-red-600 text-white":"bg-blue-500 hover:bg-blue-600 text-white")},t?"Cancelar Escaneo":"Escanear C\xf3digo"),o.a.createElement("div",{className:"text-sm text-gray-600 mt-1"},n),t&&o.a.createElement("div",{className:"fixed inset-0 bg-black z-50 flex flex-col items-center justify-center p-4"},o.a.createElement("div",{className:"w-full max-w-md"},o.a.createElement("div",{className:"flex justify-between items-center mb-2"},o.a.createElement("h2",{className:"text-lg font-bold text-white"},"Esc\xe1ner de c\xf3digos"),o.a.createElement("div",{className:"flex gap-2"},o.a.createElement("button",{onClick:()=>{i("environment"===s?"user":"environment"),t&&(g(),setTimeout(b,500))},className:"text-white text-xl p-2",title:"Cambiar c\xe1mara"},"\ud83d\udd01"),o.a.createElement("button",{onClick:g,className:"text-white text-xl p-2",title:"Cerrar esc\xe1ner"},"\u2715"))),o.a.createElement("div",{ref:m,className:"relative w-full h-64 bg-black rounded-lg overflow-hidden",id:"video"},o.a.createElement("div",{className:"absolute top-0 left-0 right-0 bottom-0 flex items-center justify-center"},o.a.createElement("div",{className:"border-2 border-red-400 w-64 h-40 relative"},o.a.createElement("div",{className:"absolute -top-1 -left-1 w-4 h-4 border-t-2 border-l-2 border-red-400"}),o.a.createElement("div",{className:"absolute -top-1 -right-1 w-4 h-4 border-t-2 border-r-2 border-red-400"}),o.a.createElement("div",{className:"absolute -bottom-1 -left-1 w-4 h-4 border-b-2 border-l-2 border-red-400"}),o.a.createElement("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 border-b-2 border-r-2 border-red-400"})))),o.a.createElement("div",{className:"mt-4 text-center text-white"},o.a.createElement("p",null,"Enfoca el c\xf3digo de barras dentro del cuadro"),o.a.createElement("p",{className:"text-yellow-300 font-medium mt-2"},n)))))},i=t(17);const m=Object(i.a)("https://qhfungoeldemkcnpqaiu.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFoZnVuZ29lbGRlbWtjbnBxYWl1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg0OTIxNDEsImV4cCI6MjA2NDA2ODE0MX0.Cyy4kZm1rGvgez19hZWY1qQ7JwxcF__doLMqYl6Qa9E"),u=e=>{const[a,t]=Object(r.useState)([]),[o,c]=Object(r.useState)(!0);return Object(r.useEffect)(()=>{(async()=>{const{data:a,error:r}=await m.from(e).select("*");r?console.error(r):t(a),c(!1)})()},[e]),{data:a,loading:o}};var b=e=>{var a,t,c,l,d,s;let{onProductAdded:i,Inventario:b=null}=e;const[g,p]=Object(r.useState)(b||{id:"",name:"",barcode:"",quantity:1,category:"",location:"",expiryDate:""}),{data:x}=u("categorias"),{data:f}=u("ubicaciones");Object(r.useEffect)(()=>{(async()=>{if(!g.barcode)return;const{data:e,error:a}=await m.from("catalogo_productos").select("*").eq("codigo_barras",g.barcode).limit(1);if(a)console.error("Error buscando por c\xf3digo de barras:",a.message);else if(e.length>0){const a=e[0];p(e=>Object(n.a)(Object(n.a)({},e),{},{name:a.nombre,category:a.categoria_id,location:a.ubicacion_id,expiryDate:a.fecha_caducidad}))}})()},[g.barcode]);const y=e=>{const{name:a,value:t}=e.target;if("quantity"===a){const e=""===t?"":parseInt(t,10);p(a=>Object(n.a)(Object(n.a)({},a),{},{quantity:e}))}else p(e=>Object(n.a)(Object(n.a)({},e),{},{[a]:t}))};return o.a.createElement("form",{onSubmit:async e=>{e.preventDefault();const a={nombre:g.name,codigo_barras:g.barcode,fecha_caducidad:g.expiryDate,categoria_id:g.category,ubicacion_id:g.location,cantidad:g.quantity},{data:t,error:r}=await m.from("catalogo_productos").select("*").eq("codigo_barras",a.codigo_barras).limit(1);if(r&&console.error("\u274c Error consultando cat\xe1logo:",r.message),!t||0===t.length){const{error:e}=await m.from("catalogo_productos").insert([{nombre:a.nombre,codigo_barras:a.codigo_barras}]);if(e)return console.error("\u274c Error al insertar en cat\xe1logo:",e.message),void alert("\u274c No se pudo guardar el producto en el cat\xe1logo")}if(b&&b.id){const{error:e}=await m.from("productos").update({nombre:a.nombre,codigo_barras:a.codigo_barras,fecha_caducidad:a.fecha_caducidad,categoria_id:a.categoria_id,ubicacion_id:a.ubicacion_id,cantidad:a.cantidad}).eq("id",b.id);if(e)return console.error("\u274c Error al actualizar producto:",e.message),void alert("\u274c Error al actualizar el producto");alert("\u2705 Producto actualizado correctamente")}else{const{data:e,error:t}=await m.from("productos").select("id, cantidad").eq("codigo_barras",a.codigo_barras).eq("nombre",a.nombre);if(t)return console.error("\u274c Error al buscar producto existente:",t.message),void alert("\u274c Error buscando productos existentes");if(e.length>0){const t=e[0],r=t.cantidad+a.cantidad;console.log("\ud83e\udde9 Producto existente:",t);const{error:o}=await m.from("productos").update({cantidad:r}).eq("id",t.id);if(o)return console.error("\u274c Error al actualizar cantidad:",o.message),void alert("\u274c Error al actualizar el producto");alert("\u2705 Producto actualizado correctamente")}else{const{error:e}=await m.from("productos").insert([a]);if(e)return console.error("\u274c Error al insertar:",e.message),void alert("\u274c Error al guardar el producto");alert("\u2705 Producto insertado correctamente")}}i&&i(),p({name:"",barcode:"",quantity:1,category:"",location:"",expiryDate:""})},className:"space-y-4"},o.a.createElement("div",null,o.a.createElement("label",{className:"block text-sm font-medium text-gray-700"},"Nombre"),o.a.createElement("input",{type:"text",name:"name",value:null!==(a=g.name)&&void 0!==a?a:"",onChange:y,required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"})),o.a.createElement("div",null,o.a.createElement("label",{className:"block text-sm font-medium text-gray-700"},"C\xf3digo de Barras"),o.a.createElement("input",{type:"text",name:"barcode",value:null!==(t=g.barcode)&&void 0!==t?t:"",onChange:y,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"})),o.a.createElement("div",null,o.a.createElement("label",{className:"block text-sm font-medium text-gray-700"},"Cantidad"),o.a.createElement("input",{type:"number",name:"quantity",min:"1",value:null!==(c=g.quantity)&&void 0!==c?c:"",onChange:y,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"})),o.a.createElement("div",null,o.a.createElement("label",{className:"block text-sm font-medium text-gray-700"},"Categor\xeda"),o.a.createElement("select",{name:"category",value:null!==(l=g.category)&&void 0!==l?l:"",onChange:y,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"},o.a.createElement("option",{value:""},"Seleccione una categor\xeda"),x.map(e=>o.a.createElement("option",{key:e.id,value:e.id},e.nombre)))),o.a.createElement("div",null,o.a.createElement("label",{className:"block text-sm font-medium text-gray-700"},"Ubicaci\xf3n"),o.a.createElement("select",{name:"location",value:null!==(d=g.location)&&void 0!==d?d:"",onChange:y,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"},o.a.createElement("option",{value:""},"Seleccione una ubicaci\xf3n"),f.map(e=>o.a.createElement("option",{key:e.id,value:e.id},e.nombre)))),o.a.createElement("div",null,o.a.createElement("label",{className:"block text-sm font-medium text-gray-700"},"Fecha de Caducidad"),o.a.createElement("input",{type:"date",name:"expiryDate",value:null!==(s=g.expiryDate)&&void 0!==s?s:"",onChange:y,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"})),o.a.createElement("button",{type:"submit",className:"w-full bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700"},b?"Actualizar Producto":"Agregar Producto"))};var g=e=>{let{onProductAdded:a,codigoInicial:t=""}=e;const[c,l]=Object(r.useState)({name:"",barcode:t,quantity:1}),[d,s]=Object(r.useState)(!1),[i,u]=Object(r.useState)(!1);Object(r.useEffect)(()=>{(async()=>{if(!t||""===t.trim())return void u(!1);s(!0);const{data:e,error:a}=await m.from("catalogo_productos").select("nombre").eq("codigo_barras",t).single();a?(console.log("\ud83d\udd0d Producto no encontrado en cat\xe1logo. Se puede a\xf1adir manualmente."),u(!1),l(e=>Object(n.a)(Object(n.a)({},e),{},{barcode:t,name:""}))):(u(!0),l(a=>Object(n.a)(Object(n.a)({},a),{},{barcode:t,name:e.nombre}))),s(!1)})()},[t]);const b=e=>{const{name:a,value:t}=e.target;l(e=>Object(n.a)(Object(n.a)({},e),{},{[a]:"quantity"===a?parseInt(t):t}))};return o.a.createElement("form",{onSubmit:async e=>{e.preventDefault();const t={nombre:c.name,codigo_barras:c.barcode,cantidad:c.quantity},{data:r,error:o}=await m.from("lista_compra").select("*").eq("nombre",t.nombre).eq("codigo_barras",t.codigo_barras).single();if(o&&"PGRST116"!==o.code)return console.error("\u274c Error al buscar producto existente:",o.message),void alert("Error al comprobar duplicados");if(r){const e=r.cantidad+t.cantidad,{error:a}=await m.from("lista_compra").update({cantidad:e}).eq("id",r.id);if(a)return console.error("\u274c Error al actualizar cantidad:",a.message),void alert("Error al actualizar el producto existente")}else{const{error:e}=await m.from("lista_compra").insert([t]);if(e)return console.error("\u274c Error al insertar nuevo producto:",e.message),void alert("Error al a\xf1adir el producto")}if(!i&&c.barcode&&""!==c.barcode.trim()){const{error:e}=await m.from("catalogo_productos").insert([{nombre:c.name,codigo_barras:c.barcode}]);e&&(console.error("\u26a0\ufe0f Error al guardar en cat\xe1logo:",e.message),alert("\u26a0\ufe0f El producto se guard\xf3 en la lista, pero no en el cat\xe1logo."))}a&&a(),l({name:"",barcode:"",quantity:1})},className:"space-y-4"},d&&o.a.createElement("p",{className:"text-sm text-gray-500"},"Buscando en el cat\xe1logo..."),o.a.createElement("div",null,o.a.createElement("label",{className:"block text-sm font-medium text-gray-700"},"Nombre"),o.a.createElement("input",{type:"text",name:"name",value:c.name,onChange:b,required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3",placeholder:"Nombre del producto"})),o.a.createElement("div",null,o.a.createElement("label",{className:"block text-sm font-medium text-gray-700"},"C\xf3digo de Barras"),o.a.createElement("input",{type:"text",name:"barcode",value:c.barcode,onChange:b,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3",placeholder:"Ej: 8431234567890"})),o.a.createElement("div",null,o.a.createElement("label",{className:"block text-sm font-medium text-gray-700"},"Cantidad"),o.a.createElement("input",{type:"number",name:"quantity",min:"1",value:c.quantity,onChange:b,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"})),o.a.createElement("button",{type:"submit",className:"w-full bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700"},"Agregar Producto"))};var p=e=>{var a,t;let{product:r,onEdit:c,onDelete:n,onAddToShoppingList:l,onTogglePlus:d,onToggleMinus:s}=e;const i=(()=>{if(!r.fecha_caducidad)return null;const e=new Date(r.fecha_caducidad)-new Date;return Math.ceil(e/864e5)})();let m="",u="";return null!==i&&(i<0?(m="bg-red-200 text-red-800",u="Caducado"):i<=3?(m="bg-yellow-200 text-yellow-800",u="Caduca en ".concat(i," d\xedas")):i<=7&&(m="bg-blue-200 text-blue-800",u="Caduca en ".concat(i," d\xedas"))),o.a.createElement("div",{className:"bg-white shadow rounded-lg p-4 mb-4"},o.a.createElement("div",{className:"flex justify-between items-start"},o.a.createElement("div",null,o.a.createElement("h3",{className:"font-medium text-lg"},r.nombre),o.a.createElement("div",{className:"mt-4 flex space-x-2"},o.a.createElement("p",{className:"text-gray-600"},"Cantidad: "),o.a.createElement("button",{onClick:()=>s(r),className:"text-sm bg-yellow-500 text-white py-1 px-1 rounded hover:bg-yellow-600"},"\u2796"),o.a.createElement("p",null,r.cantidad),o.a.createElement("button",{onClick:()=>d(r),className:"text-sm bg-yellow-500 text-white py-1 px-1 rounded hover:bg-yellow-600"},"\u2795\u200b")),o.a.createElement("p",{className:"text-gray-600"},"Categor\xeda: ",null===(a=r.categorias)||void 0===a?void 0:a.nombre),o.a.createElement("p",{className:"text-gray-600"},"Ubicaci\xf3n: ",null===(t=r.ubicaciones)||void 0===t?void 0:t.nombre),r.fecha_caducidad&&o.a.createElement("p",{className:"text-gray-600"},"Caduca: ",new Date(r.fecha_caducidad).toLocaleDateString())),u&&o.a.createElement("span",{className:"px-2 py-1 text-xs font-semibold rounded-full ".concat(m)},u)),o.a.createElement("div",{className:"mt-4 justify-between flex space-x-2"},o.a.createElement("div",{className:"mt-4 flex space-x-2"},o.a.createElement("button",{onClick:()=>c(r),className:"text-sm bg-blue-500 text-white py-1 px-3 rounded hover:bg-blue-600"},"Editar \ud83d\udcdd"),o.a.createElement("button",{onClick:()=>n(r.id),className:"text-sm bg-red-500 text-white py-1 px-3 rounded hover:bg-red-600"},"Eliminar \u274c")),o.a.createElement("div",{className:"mt-4 flex space-x-2 px-5"},o.a.createElement("button",{onClick:()=>l(r),className:"text-sm bg-green-500 text-white py-1 px-3 rounded hover:bg-green-600"},"\ud83d\uded2"))))};var x=e=>{let{product:a,onTogglePurchased:t,onTogglePlus:c,onToggleMinus:n}=e;const{lista:l,loading:d}=(()=>{const[e,a]=Object(r.useState)([]),[t,o]=Object(r.useState)(!0);return Object(r.useEffect)(()=>{(async()=>{o(!0);const{data:e,error:t}=await m.from("lista_compra").select("*").order("created_at",{ascending:!1});t?console.error("Error al obtener lista de compra:",t.message):a(e),o(!1)})()},[]),{lista:e,loading:t}})();return d?o.a.createElement("p",null,"Cargando lista de la compra..."):0===l.length?o.a.createElement("p",null,"No hay productos en tu cesta."):o.a.createElement("div",{className:"bg-white shadow rounded-lg p-4 mb-4 border-l-4 border-green-500"},o.a.createElement("div",{className:"flex justify-between items-start"},o.a.createElement("div",null,o.a.createElement("h3",{className:"font-medium text-lg"},a.nombre),o.a.createElement("div",{className:"mt-4 flex space-x-2"},o.a.createElement("p",{className:"text-gray-600"},"Cantidad:"),o.a.createElement("button",{onClick:()=>n(a),className:"text-sm bg-yellow-500 text-white py-1 px-1 rounded hover:bg-yellow-600"},"\u2796"),o.a.createElement("p",null,a.cantidad),o.a.createElement("button",{onClick:()=>c(a),className:"text-sm bg-yellow-500 text-white py-1 px-1 rounded hover:bg-yellow-600"},"\u2795\u200b")))),o.a.createElement("div",{className:"mt-4 flex space-x-2"},o.a.createElement("button",{onClick:()=>t(a),className:"text-sm bg-green-500 text-white py-1 px-3 rounded hover:bg-green-600"},"Comprado")))};var f=e=>{let{product:a,onDelete:t,onAddToShoppingList:c}=e;const{caducados:n,loading:l}=(()=>{const[e,a]=Object(r.useState)([]),[t,o]=Object(r.useState)(!0),c=async()=>{if(e.length>0)return;o(!0),(new Date).toISOString().split("T")[0];const{data:t,error:r}=await m.from("caducados").select("*");r?(console.error("Error al cargar productos caducados:",r),a([])):a(t),o(!1)};return Object(r.useEffect)(()=>{c()},[]),{caducados:e,loading:t,fetchCaducados:c,setCaducados:a}})();return l?o.a.createElement("p",null,"Cargando productos caducados..."):0===n.length?o.a.createElement("p",null,"No hay productos caducados."):o.a.createElement("div",{className:"bg-white shadow rounded-lg p-4 mb-4 border-l-4 border-red-500"},o.a.createElement("div",{className:"flex justify-between items-start"},o.a.createElement("div",null,o.a.createElement("h3",{className:"font-medium text-lg"},a.nombre),o.a.createElement("p",{className:"text-gray-600"},"Cantidad: ",a.cantidad),o.a.createElement("p",{className:"text-gray-600"},"Categor\xeda: ",a.categorias.nombre),o.a.createElement("p",{className:"text-gray-600"},"Ubicaci\xf3n: ",a.ubicaciones.nombre),a.fecha_caducidad&&o.a.createElement("p",{className:"text-gray-600"},"Caduc\xf3 el:"," ",new Date(a.fecha_caducidad).toLocaleDateString())),o.a.createElement("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800"},"Caducado")),o.a.createElement("div",{className:"mt-4 flex space-x-2"},o.a.createElement("button",{onClick:()=>c(a),className:"text-sm bg-green-500 text-white py-1 px-3 rounded hover:bg-green-600"},"A\xf1adir a compras"),o.a.createElement("button",{onClick:()=>t(a),className:"text-sm bg-red-500 text-white py-1 px-3 rounded hover:bg-red-600"},"Eliminar")))};const y=e=>{let{isOpen:a,onClose:t}=e;const[c,n]=Object(r.useState)(""),[l,d]=Object(r.useState)(""),[s,i]=Object(r.useState)([]),[u,b]=Object(r.useState)([]),g=async()=>{const{data:e}=await m.from("categorias").select("*"),{data:a}=await m.from("ubicaciones").select("*");i(e||[]),b(a||[])};Object(r.useEffect)(()=>{g(),a&&g()},[a]);return o.a.createElement("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},o.a.createElement("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-md max-h-[90vh] flex flex-col"},o.a.createElement("div",{className:"flex justify-between items-center p-4 border-b"},o.a.createElement("h2",{className:"text-lg font-semibold text-gray-800"},"Ajustes"),o.a.createElement("button",{onClick:t,className:"text-gray-500 hover:text-red-600 text-xl font-bold"},"\xd7")),o.a.createElement("div",{className:"overflow-y-auto p-4 space-y-4 flex-1"},o.a.createElement("div",{className:"flex items-center justify-between"},o.a.createElement("div",{className:"overflow-y-auto p-4 space-y-4 flex-1"},o.a.createElement("div",{className:"mb-4"},o.a.createElement("label",{className:"block mb-1 text-sm font-medium text-gray-700"},"Nueva Categor\xeda"),o.a.createElement("input",{type:"text",value:c,onChange:e=>n(e.target.value),className:"w-full border border-gray-300 rounded text-gray-700 px-3 py-2"}),o.a.createElement("button",{onClick:async()=>{""!==c.trim()&&(await m.from("categorias").insert([{nombre:c.trim()}]),n(""),g())},className:"mt-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"},"A\xf1adir Categor\xeda")),o.a.createElement("h3",{className:"text-md font-semibold text-gray-700 mt-4 mb-1"},"Categor\xedas existentes"),o.a.createElement("ul",{className:"space-y-1 mb-4"},s.map(e=>o.a.createElement("li",{key:e.id,className:"flex justify-between text-gray-700 items-center border-b py-1"},o.a.createElement("span",{className:"px-2"},e.nombre),o.a.createElement("button",{onClick:()=>(async e=>{await m.from("categorias").delete().eq("id",e),g()})(e.id),className:"text-red-500 hover:text-red-700 text-sm"},"Eliminar"))))),o.a.createElement("div",{className:"overflow-y-auto p-4 space-y-4 flex-1"},o.a.createElement("div",{className:"mb-4"},o.a.createElement("label",{className:"block mb-1 text-sm font-medium text-gray-700"},"Nueva Ubicaci\xf3n"),o.a.createElement("input",{type:"text",value:l,onChange:e=>d(e.target.value),className:"w-full border border-gray-300 text-gray-700 rounded px-3 py-2"}),o.a.createElement("button",{onClick:async()=>{""!==l.trim()&&(await m.from("ubicaciones").insert([{nombre:l.trim()}]),d(""),g())},className:"mt-2 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"},"A\xf1adir Ubicaci\xf3n")),o.a.createElement("h3",{className:"text-md font-semibold text-gray-700 mt-4 mb-1"},"Ubicaciones existentes"),o.a.createElement("ul",{className:"space-y-1"},u.map(e=>o.a.createElement("li",{key:e.id,className:"flex justify-between text-gray-700 items-center border-b py-1"},o.a.createElement("span",{className:"px-2"},e.nombre),o.a.createElement("button",{onClick:()=>(async e=>{await m.from("ubicaciones").delete().eq("id",e),g()})(e.id),className:"text-red-500 hover:text-red-700 text-sm"},"Eliminar"))))))),o.a.createElement("div",{className:"p-2 border-t text-center text-sm text-gray-400"},"\xa9 SmartFridge")))};var E=e=>{let{onResults:a}=e;const[t,c]=Object(r.useState)(""),[n,l]=Object(r.useState)(""),[d,s]=Object(r.useState)(""),[i,u]=Object(r.useState)([]),[b,g]=Object(r.useState)([]);Object(r.useEffect)(()=>{(async()=>{const{data:e}=await m.from("categorias").select("*"),{data:a}=await m.from("ubicaciones").select("*");u(e),g(a)})()},[]);const p=async()=>{const e=t.trim();if(""===e)return void a(null,null,"");let r=m.from("productos").select("*, categorias(nombre), ubicaciones(nombre)").or("nombre.ilike.%".concat(e,"%,codigo_barras.ilike.%").concat(e,"%"));n&&(r=r.eq("categoria_id",n)),d&&(r=r.eq("ubicacion_id",d));const{data:o,error:c}=await r;if(c)return alert("\u274c Error buscando productos");const{data:l,error:s}=await m.from("catalogo_productos").select("*").or("nombre.ilike.%".concat(e,"%,codigo_barras.ilike.%").concat(e,"%"));if(s)return alert("\u274c Error al buscar en el cat\xe1logo");a(o,l)};return o.a.createElement("div",{className:"flex flex-col md:flex-row gap-2 mb-4 fill-width"},o.a.createElement("div",{style:{position:"relative",display:"flex",alignItems:"center",width:"100%",height:"100%"}},o.a.createElement("input",{type:"text",placeholder:"Buscar por nombre o c\xf3digo de barras",value:t,onChange:e=>c(e.target.value),className:"border px-3 py-4 rounded w-full",onKeyDown:e=>{"Enter"===e.key&&p()}}),t&&o.a.createElement("button",{onClick:()=>{c(""),a([],[],"")},style:{position:"absolute",right:"8px",background:"transparent",border:"none",cursor:"pointer",fontSize:"18px",color:"#999"}},"\u2715")),o.a.createElement("select",{value:n,onChange:e=>l(e.target.value),className:"border px-3 py-2 rounded"},o.a.createElement("option",{value:""},"Todas las categor\xedas"),i.map(e=>o.a.createElement("option",{key:e.id,value:e.id},e.nombre))),o.a.createElement("select",{value:d,onChange:e=>s(e.target.value),className:"border px-3 py-2 rounded"},o.a.createElement("option",{value:""},"Todas las ubicaciones"),b.map(e=>o.a.createElement("option",{key:e.id,value:e.id},e.nombre))),o.a.createElement("button",{onClick:p,className:"text-sm bg-blue-500 text-white py-2 px-3 rounded hover:bg-blue-600"},"Buscar \ud83d\udd0d"))};var v=()=>{const[e,a]=Object(r.useState)([]),[t,c]=Object(r.useState)([]),[l,d]=Object(r.useState)([]),[i,u]=Object(r.useState)("inventory"),[v,h]=Object(r.useState)(!1),[w,N]=Object(r.useState)(null),[_,j]=Object(r.useState)(!1),[C,O]=Object(r.useState)(null),[k,S]=Object(r.useState)(""),q=async()=>{const{data:e,error:t}=await m.from("productos").select("id, nombre, codigo_barras, cantidad, fecha_caducidad, categorias (nombre), ubicaciones (nombre)");t||a(e)},D=async()=>{const{data:e,error:a}=await m.from("caducados").select("id, nombre, cantidad, fecha_caducidad, categorias (nombre), ubicaciones (nombre)");a||d(e)},A=async()=>{const{data:e,error:a}=await m.from("lista_compra").select("*");a||c(e)};Object(r.useEffect)(()=>{"shopping"===i&&A(),"inventory"===i&&q(),"expired"===i&&D()},[i]),Object(r.useEffect)(()=>{q(),D(),A(),I()},[]);const I=async()=>{const e=new Date,{data:a,error:t}=await m.from("productos").select("*");if(t)return void console.error("Error al obtener productos:",t.message);const r=a.filter(a=>new Date(a.fecha_caducidad)<e);for(const c of r)await m.from("productos").delete().eq("id",c.id);const o=Date.now().toString();for(const c of r){const{data:e}=await m.from("categorias").select("nombre").eq("id",c.categoria_id).single(),{data:a}=await m.from("ubicaciones").select("nombre").eq("id",c.ubicacion_id).single(),{data:t,error:r}=await m.from("lista_compra").select("id").eq("codigo_barras",c.codigo_barras).eq("es_caducado",!0).maybeSingle();t||await m.from("lista_compra").insert([Object(n.a)(Object(n.a)({id:o},c),{},{es_caducado:!0})]),0===(await m.from("caducados").select("id").eq("nombre",c.nombre).eq("codigo_barras",c.codigo_barras).eq("fecha_caducidad",c.fecha_caducidad)).data.length&&await m.from("caducados").insert({nombre:c.nombre,cantidad:c.cantidad,codigo_barras:c.codigo_barras,fecha_caducidad:c.fecha_caducidad,categoria_id:c.categoria_id,ubicacion_id:c.ubicacion_id})}q(),D(),A()},T=e=>{console.log("\ud83d\udcdd Editando producto:",e),N({id:e.id,name:e.nombre,barcode:e.codigo_barras,quantity:e.cantidad,expiryDate:e.fecha_caducidad,category:e.categoria_id,location:e.ubicacion_id}),h(!0),setTimeout(()=>{window.scrollTo({top:0,behavior:"smooth"})},100)},P=async e=>{const{error:t}=await m.from("productos").delete().eq("id",e);t?(console.error("\u274c Error al eliminar producto:",t.message),alert("\u274c No se pudo eliminar el producto")):(a(a=>a.filter(a=>a.id!==e)),Y(a=>a?a.filter(a=>a.id!==e):a),Q(a=>a?a.filter(a=>a.id!==e):a)),q()},z=async e=>{const{error:a}=await m.from("caducados").delete().eq("id",e.id);a||d(a=>a.filter(a=>a.id!==e.id)),D()},F=async e=>{const a=(e=>{var a,t,r,o,c,n,l,d,s;return{nombre:e.nombre,cantidad:null!==(a=e.cantidad)&&void 0!==a?a:1,codigo_barras:null!==(t=e.codigo_barras)&&void 0!==t?t:null,fecha_caducidad:null!==(r=e.fecha_caducidad)&&void 0!==r?r:null,categoria_id:null!==(o=null!==(c=e.categoria_id)&&void 0!==c?c:null===(n=e.categorias)||void 0===n?void 0:n.id)&&void 0!==o?o:null,ubicacion_id:null!==(l=null!==(d=e.ubicacion_id)&&void 0!==d?d:null===(s=e.ubicaciones)||void 0===s?void 0:s.id)&&void 0!==l?l:null,es_caducado:!1}})(e);console.log("Normalizado:",a);const{error:t}=await m.from("lista_compra").insert(a);t?(console.error("\u274c Error al insertar en lista_compra:",t),alert("\u274c No se pudo a\xf1adir el producto")):A()},L=async e=>{const{error:a}=await m.from("lista_compra").delete().eq("id",e.id);a||c(t.filter(a=>a.id!==e.id)),A()},M=async e=>{const{error:a}=await m.from("lista_compra").update({cantidad:e.cantidad+1}).eq("id",e.id);a||c(t.filter(a=>a.id!==e.id)),A()},J=async e=>{const{error:a}=await m.from("lista_compra").update({cantidad:e.cantidad-1}).eq("id",e.id);if(a||c(t.filter(a=>a.id!==e.id)),1===e.cantidad){const{error:a}=await m.from("lista_compra").delete().eq("id",e.id);a||c(t.filter(a=>a.id!==e.id))}A()},B=async t=>{const r=t.cantidad+1,{error:o}=await m.from("productos").update({cantidad:r}).eq("id",t.id);if(!o&&(a(e.map(e=>e.id===t.id?Object(n.a)(Object(n.a)({},e),{},{cantidad:r}):e)),G.length>0)){const e=G.map(e=>e.id===t.id?Object(n.a)(Object(n.a)({},e),{},{cantidad:r}):e);Y(e)}q()},R=async t=>{const r=t.cantidad-1,{error:o}=await m.from("productos").update({cantidad:r}).eq("id",t.id);if(!o&&(a(e.map(e=>e.id===t.id?Object(n.a)(Object(n.a)({},e),{},{cantidad:r}):e)),G.length>0)){const e=G.map(e=>e.id===t.id?Object(n.a)(Object(n.a)({},e),{},{cantidad:r}):e);Y(e)}if(1===t.cantidad){const{error:r}=await m.from("productos").delete().eq("id",t.id);r||a(e.filter(e=>e.id!==t.id))}q()},[U,Z]=Object(r.useState)(!1),[G,Y]=Object(r.useState)([]),[X,Q]=Object(r.useState)(null),[V,W]=Object(r.useState)(""),[K,H]=Object(r.useState)(!1);return Object(r.useEffect)(()=>{if(K){const e=setTimeout(()=>{H(!1)},3e3);return()=>clearTimeout(e)}},[K]),o.a.createElement("div",{className:"min-h-screen bg-gray-800 p-4"},o.a.createElement("div",{className:"max-w-6xl mx-auto bg-white rounded-lg shadow overflow-hidden"},o.a.createElement("div",{className:"p-4 bg-blue-600 text-white"},o.a.createElement("div",{className:"flex items-center justify-between"},o.a.createElement("h1",{className:"text-2xl font-bold"},"SmartFridge"),o.a.createElement("button",{onClick:()=>Z(!0),className:"bg-gray-700 text-white px-3 py-2 rounded hover:bg-gray-700"},"\u2699\ufe0f Ajustes")),o.a.createElement("p",{className:"text-blue-100"},"Control total de tu cocina"),U&&o.a.createElement(y,{onClose:()=>Z(!1)})),o.a.createElement("div",{className:"flex border-b"},o.a.createElement("button",{className:"flex-1 py-2 px-4 font-medium ".concat("inventory"===i?"text-blue-600 border-b-2 border-blue-600":"text-gray-600"),onClick:()=>u("inventory")},"Inventario \ud83d\udccb\u200b"),o.a.createElement("button",{className:"flex-1 py-2 px-4 font-medium ".concat("shopping"===i?"text-blue-600 border-b-2 border-blue-600":"text-gray-600"),onClick:()=>u("shopping")},"Lista de la compra \ud83d\uded2"),o.a.createElement("button",{className:"flex-1 py-2 px-4 font-medium ".concat("expired"===i?"text-blue-600 border-b-2 border-blue-600":"text-gray-600"),onClick:()=>u("expired")},"Caducados (",l.length,") \u2623\ufe0f\u200b")),o.a.createElement("div",{className:"p-4"},"inventory"===i?o.a.createElement(o.a.Fragment,null,o.a.createElement("div",null,o.a.createElement(E,{onResults:(e,a,t)=>{Y(Array.isArray(e)?e:[]),Q(Array.isArray(a)?a:[]),W(t),H(""===t&&null===e)}}),K&&o.a.createElement("div",{className:"bg-yellow-100 text-yellow-800 border-l-4 border-yellow-500 p-3 rounded my-3 shadow"},"\u26a0\ufe0f Por favor, escribe un texto para buscar un producto.")),o.a.createElement("div",{className:"flex space-x-2 mb-4"},o.a.createElement(s,{onScan:e=>{h(!0),N({name:"",barcode:e,quantity:1,category:"otros",location:"despensa-estante1",expiryDate:""})}}),o.a.createElement("button",{onClick:()=>{h(!0),N(null),q()},className:"bg-green-500 text-white py-2 px-4 rounded-lg hover:bg-green-600 transition-colors"},"A\xf1adir Manualmente")),v&&o.a.createElement("div",{className:"mb-6 p-4 border rounded-lg bg-gray-50"},o.a.createElement(b,{onProductAdded:t=>{w&&w.id?a(e.map(e=>e.id===w.id?Object(n.a)(Object(n.a)({},t),{},{id:w.id}):e)):a([...e,Object(n.a)(Object(n.a)({},t),{},{id:Date.now().toString()})]),q(),h(!1),N(null),I()},Inventario:w}),o.a.createElement("button",{onClick:()=>{h(!1),N(null),q()},className:"mt-2 text-sm text-gray-600 hover:text-gray-800"},"Cancelar")),o.a.createElement("div",{className:"space-y-4"},Array.isArray(X)&&X.length>0&&o.a.createElement("div",null,o.a.createElement("p",{className:"text-yellow-600 font-semibold mt-2"},"Los siguientes productos est\xe1n agotados:"),o.a.createElement("ul",{className:"mt-2 space-y-2"},X.map(e=>o.a.createElement("li",{key:e.id,className:"flex items-center justify-between bg-yellow-100 p-2 rounded"},o.a.createElement("span",null,e.nombre),o.a.createElement("button",{onClick:async()=>{const{error:a}=await m.from("lista_compra").insert({nombre:e.nombre,cantidad:1,codigo_barras:e.codigo_barras,categoria_id:e.categoria_id,ubicacion_id:e.ubicacion_id,es_caducado:!1});a?alert("\u274c Error al a\xf1adir a la lista de la compra"):(alert('\u2705 A\xf1adido "'.concat(e.nombre,'" a la lista de la compra')),A())},className:"text-sm bg-blue-500 text-white py-1 px-3 rounded hover:bg-blue-600"},"A\xf1adir \ud83d\uded2"))))),0===(G.length>0?G:e).length?o.a.createElement("p",{className:"text-gray-500"},"No hay productos en tu inventario. \xa1A\xf1ade algunos!"):(G.length>0?G:e).map(e=>o.a.createElement(p,{key:e.id,product:e,onEdit:T,onDelete:P,onAddToShoppingList:F,onTogglePlus:B,onToggleMinus:R})))):"shopping"===i?o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"flex space-x-2 mb-4"},o.a.createElement(s,{onScan:e=>{S(e),j(!0)}}),o.a.createElement("button",{onClick:()=>{j(!0),S(""),O(null),A()},className:"bg-green-500 text-white py-2 px-4 rounded-lg hover:bg-green-600 transition-colors"},"A\xf1adir Producto")),_&&o.a.createElement("div",{className:"mb-6 p-4 border rounded-lg bg-gray-50"},o.a.createElement(g,{codigoInicial:k,onProductAdded:()=>{j(!1),S(""),A()}}),o.a.createElement("button",{onClick:()=>{j(!1),A()},className:"mt-2 text-sm text-gray-600 hover:text-gray-800"},"Cancelar")),o.a.createElement("div",{className:"space-y-4"},0===t.length?o.a.createElement("p",{className:"text-gray-500"},"Tu lista de la compra est\xe1 vac\xeda. \xa1A\xf1ade algunos productos!"):t.map(e=>o.a.createElement(x,{key:e.id,product:e,onTogglePurchased:L,onTogglePlus:M,onToggleMinus:J})))):o.a.createElement(o.a.Fragment,null,o.a.createElement("h2",{className:"text-xl font-semibold mb-4"},"Productos Caducados"),o.a.createElement("div",{className:"space-y-4"},0===l.length?o.a.createElement("p",{className:"text-gray-500"},"\xa1Genial! No tienes productos caducados."):l.map(e=>o.a.createElement(f,{key:e.id,product:e,onDelete:z,onAddToShoppingList:F}))))),o.a.createElement("div",{className:"p-2 border-t text-center text-sm text-gray-400"},"\xa9 SmartFridge")))};Object(c.createRoot)(document.getElementById("root")).render(o.a.createElement(v,null))}},[[18,1,2]]]);
//# sourceMappingURL=main.7ce83ae0.chunk.js.map